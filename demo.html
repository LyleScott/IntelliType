<!DOCTYPE html>
<html>
    <head>
        <title>AJAX test</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>

        <script>
            var KEY_ENTER = 13;
            var HOST = 'http://localhost:8080';
        
            function ajaxError(jqXHR, textStatus, errorThrown) {
            	// Attempt to gracefully print an error in a jQuery AJAX call.
                if (console && console.log) {
                    console.log('jQuery AJAX error:\n' +
                    		    textStatus + '\n' +
                    		    errorThrown);
                }
            }
            
            function getSuggestionAjaxCall(query) {
            	// Make an AJAX call to get a list of suggestions.
                $.ajax({
                    url: HOST + '',
                    data: {'userinput': query, 'cb': 'get_suggestions'},
                    datatype: 'jsonp',
                    jsonp: 'callback',
                    jsonpCallback: 'get_suggestions',
                    success: getSuggestionsCallback,
                    error: ajaxError
                });
            }
            
            function getSuggestionsCallback(data, textStatus, jqXHR) {
            	// Parse the returned value as JSON.
                data = data.substring('get_suggestions('.length, data.length); 
                data = data.substring(0, data.length-1);
                
                try {
                    var json = $.parseJSON(data);
                } catch (e) {
                	var json = ['error in the get_suggestions() callback:', e,]
                }
        
                $('#results').html(json.results.join('<br>'));
            }
            
            function submitQueryAjaxCall(query) {
                // Make an AJAX call to get a list of suggestions.
                $.ajax({
                    url: HOST,
                    data: {'userinput': query, 'cb': 'submit_query'},
                    datatype: 'jsonp',
                    jsonp: 'callback',
                    jsonpCallback: 'submit_query',
                    success: submitQueryCallback,
                    error: ajaxError
                });
            }
            
            function submitQueryCallback(data, textStatus, jqXHR) {
                // Parse the returned value as JSON.
                data = data.substring('submit_query('.length, data.length); 
                data = data.substring(0, data.length-1);
                
                try {
                    var json = $.parseJSON(data);
                } catch (e) {
                    var json = ['error in the submit_query() callback:', e,]
                }
        
                $('#results').html(json.results.join('<br>'));
            }
        
            $(document).ready(function(){
            	
                $("#userinput").bind('keyup', function(event) {
                	
                	// Bail if no input in the text entry.
                	if (!$(this).val()) {
                        return;
                    }
                	
                	var query = $(this).val();

                	if (event && event.keyCode == KEY_ENTER) {
                        // Add the query to the collection of known queries.
                        submitQueryAjaxCall(query);
                        $(this).val('');
                        $('#results').html('');
                	} else {
                        // Get suggestions based on what the user is typing.
                		getSuggestionAjaxCall(query);
                	}
                });  // userinput keyup
                
            });  // end document ready
        </script>
    </head>
<body>

<input type="text" id="userinput" />
<div id="results"></div>

</body>
</html>